<form class="{{cssClass}} flexcol" autocomplete="off">
    
    {{!-- Character Header --}}
    <header class="sheet-header">
        <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" height="100" width="100"/>
        
        <div class="header-fields">
            <h1 class="charname">
                <input name="name" type="text" value="{{actor.name}}" placeholder="Character Name"/>
            </h1>
            
            <div class="resource-row">
                <div class="resource">
                    <label>Race</label>
                    <input type="text" name="system.personalDetails.race" value="{{system.personalDetails.race}}" />
                </div>
                <div class="resource">
                    <label>Current Career</label>
                    <span class="current-career-display">{{currentCareer}}</span>
                </div>
                <div class="resource full-width">
                    <label>Previous Careers</label>
                    <input type="text" name="system.previousCareersText" value="{{system.previousCareersText}}" placeholder="List previous careers"/>
                </div>
            </div>
        </div>

        <div class="experience-header">
            <h4>Experience</h4>
            <div class="experience-fields">
                <div class="xp-field">
                    <label>Total XP</label>
                    <input type="number" name="system.experience.total" value="{{system.experience.total}}" />
                </div>
                <div class="xp-field">
                    <label>Spent XP</label>
                    <input type="number" name="system.experience.spent" value="{{system.experience.spent}}" />
                </div>
            </div>
        </div>
    </header>

    {{!-- Sheet Tab Navigation --}}
    <nav class="sheet-tabs tabs" data-group="primary">
        <a class="item" data-tab="main">Main</a>
        <a class="item" data-tab="skills">Skills</a>
        <a class="item" data-tab="career">Career</a>
        <a class="item" data-tab="combat">Combat</a>
        <a class="item" data-tab="spells">Spells</a>
        <a class="item" data-tab="inventory">Inventory</a>
        <a class="item" data-tab="biography">Biography</a>
    </nav>

    {{!-- Sheet Body --}}
    <section class="sheet-body">

        {{!-- Main Tab --}}
        <div class="tab main" data-group="primary" data-tab="main">
            
            {{!-- Main Profile Table --}}
            <div class="profile-section">
                <h3>Main Profile</h3>
                <table class="profile-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th class="rollable-characteristic" data-characteristic="ws" title="Click to roll">WS</th>
                            <th class="rollable-characteristic" data-characteristic="bs" title="Click to roll">BS</th>
                            <th class="rollable-characteristic" data-characteristic="s" title="Click to roll">S</th>
                            <th class="rollable-characteristic" data-characteristic="t" title="Click to roll">T</th>
                            <th class="rollable-characteristic" data-characteristic="ag" title="Click to roll">Ag</th>
                            <th class="rollable-characteristic" data-characteristic="int" title="Click to roll">Int</th>
                            <th class="rollable-characteristic" data-characteristic="wp" title="Click to roll">WP</th>
                            <th class="rollable-characteristic" data-characteristic="fel" title="Click to roll">Fel</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="row-label">Starting</td>
                            <td><input type="number" name="system.characteristics.ws.initial" value="{{system.characteristics.ws.initial}}" /></td>
                            <td><input type="number" name="system.characteristics.bs.initial" value="{{system.characteristics.bs.initial}}" /></td>
                            <td><input type="number" name="system.characteristics.s.initial" value="{{system.characteristics.s.initial}}" /></td>
                            <td><input type="number" name="system.characteristics.t.initial" value="{{system.characteristics.t.initial}}" /></td>
                            <td><input type="number" name="system.characteristics.ag.initial" value="{{system.characteristics.ag.initial}}" /></td>
                            <td><input type="number" name="system.characteristics.int.initial" value="{{system.characteristics.int.initial}}" /></td>
                            <td><input type="number" name="system.characteristics.wp.initial" value="{{system.characteristics.wp.initial}}" /></td>
                            <td><input type="number" name="system.characteristics.fel.initial" value="{{system.characteristics.fel.initial}}" /></td>
                        </tr>
                        <tr>
                            <td class="row-label">Advance</td>
                            <td><input type="number" name="system.characteristics.ws.advances" value="{{system.characteristics.ws.advances}}" /></td>
                            <td><input type="number" name="system.characteristics.bs.advances" value="{{system.characteristics.bs.advances}}" /></td>
                            <td><input type="number" name="system.characteristics.s.advances" value="{{system.characteristics.s.advances}}" /></td>
                            <td><input type="number" name="system.characteristics.t.advances" value="{{system.characteristics.t.advances}}" /></td>
                            <td><input type="number" name="system.characteristics.ag.advances" value="{{system.characteristics.ag.advances}}" /></td>
                            <td><input type="number" name="system.characteristics.int.advances" value="{{system.characteristics.int.advances}}" /></td>
                            <td><input type="number" name="system.characteristics.wp.advances" value="{{system.characteristics.wp.advances}}" /></td>
                            <td><input type="number" name="system.characteristics.fel.advances" value="{{system.characteristics.fel.advances}}" /></td>
                        </tr>
                        <tr class="current-row">
                            <td class="row-label">Current</td>
                            <td class="current-value rollable-characteristic" data-characteristic="ws" title="Click to roll">{{system.characteristics.ws.current}}</td>
                            <td class="current-value rollable-characteristic" data-characteristic="bs" title="Click to roll">{{system.characteristics.bs.current}}</td>
                            <td class="current-value rollable-characteristic" data-characteristic="s" title="Click to roll">{{system.characteristics.s.current}}</td>
                            <td class="current-value rollable-characteristic" data-characteristic="t" title="Click to roll">{{system.characteristics.t.current}}</td>
                            <td class="current-value rollable-characteristic" data-characteristic="ag" title="Click to roll">{{system.characteristics.ag.current}}</td>
                            <td class="current-value rollable-characteristic" data-characteristic="int" title="Click to roll">{{system.characteristics.int.current}}</td>
                            <td class="current-value rollable-characteristic" data-characteristic="wp" title="Click to roll">{{system.characteristics.wp.current}}</td>
                            <td class="current-value rollable-characteristic" data-characteristic="fel" title="Click to roll">{{system.characteristics.fel.current}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            {{!-- Secondary Profile Table --}}
            <div class="profile-section">
                <h3>Secondary Profile</h3>
                <table class="profile-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>A</th>
                            <th>W</th>
                            <th>SB</th>
                            <th>TB</th>
                            <th>M</th>
                            <th>Mag</th>
                            <th>IP</th>
                            <th>FP</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="row-label">Starting</td>
                            <td><input type="number" name="system.secondary.attacks.initial" value="{{system.secondary.attacks.initial}}" /></td>
                            <td><input type="number" name="system.secondary.wounds.initial" value="{{system.secondary.wounds.initial}}" /></td>
                            <td class="calculated-value">-</td>
                            <td class="calculated-value">-</td>
                            <td><input type="number" name="system.secondary.movement.initial" value="{{system.secondary.movement.initial}}" /></td>
                            <td><input type="number" name="system.secondary.magic.initial" value="{{system.secondary.magic.initial}}" /></td>
                            <td><input type="number" name="system.secondary.insanityPoints.total" value="{{system.secondary.insanityPoints.total}}" /></td>
                            <td><input type="number" name="system.secondary.fatePoints.initial" value="{{system.secondary.fatePoints.initial}}" /></td>
                        </tr>
                        <tr>
                            <td class="row-label">Advance</td>
                            <td><input type="number" name="system.secondary.attacks.advances" value="{{system.secondary.attacks.advances}}" /></td>
                            <td><input type="number" name="system.secondary.wounds.advances" value="{{system.secondary.wounds.advances}}" /></td>
                            <td class="calculated-value">-</td>
                            <td class="calculated-value">-</td>
                            <td><input type="number" name="system.secondary.movement.advances" value="{{system.secondary.movement.advances}}" /></td>
                            <td><input type="number" name="system.secondary.magic.advances" value="{{system.secondary.magic.advances}}" /></td>
                            <td class="calculated-value">-</td>
                            <td class="calculated-value">-</td>
                        </tr>
                        <tr class="current-row">
                            <td class="row-label">Current</td>
                            <td class="current-value">{{system.secondary.attacks.current}}</td>
                            <td><input type="number" name="system.secondary.wounds.current" value="{{system.secondary.wounds.current}}" placeholder="Current" /></td>
                            <td class="current-value">{{system.secondary.strengthBonus.value}}</td>
                            <td class="current-value">{{system.secondary.toughnessBonus.value}}</td>
                            <td class="current-value">{{system.secondary.movement.current}}</td>
                            <td class="current-value">{{system.secondary.magic.current}}</td>
                            <td><input type="number" name="system.secondary.insanityPoints.current" value="{{system.secondary.insanityPoints.current}}" /></td>
                            <td><input type="number" name="system.secondary.fatePoints.current" value="{{system.secondary.fatePoints.current}}" /></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            {{!-- Talents --}}
            <div class="talents-section">
                <h3>Talents</h3>
                <div class="talents-list">
                    <div class="talent-header">
                        <span>Name</span>
                        <span>Description</span>
                        <span>Advancement</span>
                        <span></span>
                    </div>
                    {{#each system.talents as |talent idx|}}
                    <div class="talent-row">
                        <input type="text" name="system.talents.{{idx}}.name" value="{{talent.name}}" placeholder="Talent Name"/>
                        <input type="text" name="system.talents.{{idx}}.description" value="{{talent.description}}" placeholder="Description"/>
                        <input type="number" name="system.talents.{{idx}}.timesTaken" value="{{talent.timesTaken}}" min="1"/>
                        <a class="talent-delete" data-index="{{idx}}"><i class="fas fa-trash"></i></a>
                    </div>
                    {{/each}}
                    <button type="button" class="add-talent">Add Talent</button>
                </div>
            </div>

            {{!-- Mutations --}}
            <div class="mutations-section">
                <h3>Mutations</h3>
                <div class="mutations-list">
                    <div class="mutation-header">
                        <span>Name</span>
                        <span>Description</span>
                        <span></span>
                    </div>
                    {{#each system.mutations as |mutation idx|}}
                    <div class="mutation-row">
                        <input type="text" name="system.mutations.{{idx}}.name" value="{{mutation.name}}" placeholder="Mutation Name"/>
                        <input type="text" name="system.mutations.{{idx}}.description" value="{{mutation.description}}" placeholder="Description"/>
                        <a class="mutation-delete" data-index="{{idx}}"><i class="fas fa-trash"></i></a>
                    </div>
                    {{/each}}
                    <button type="button" class="add-mutation">Add Mutation</button>
                </div>
            </div>

            {{!-- Insanities --}}
            <div class="insanities-section">
                <h3>Insanities</h3>
                <div class="insanities-list">
                    <div class="insanity-header">
                        <span>Name</span>
                        <span>Description</span>
                        <span></span>
                    </div>
                    {{#each system.insanities as |insanity idx|}}
                    <div class="insanity-row">
                        <input type="text" name="system.insanities.{{idx}}.name" value="{{insanity.name}}" placeholder="Insanity Name"/>
                        <input type="text" name="system.insanities.{{idx}}.description" value="{{insanity.description}}" placeholder="Description"/>
                        <a class="insanity-delete" data-index="{{idx}}"><i class="fas fa-trash"></i></a>
                    </div>
                    {{/each}}
                    <button type="button" class="add-insanity">Add Insanity</button>
                </div>
            </div>

            {{!-- Misc Special Rules --}}
            <div class="special-rules-section">
                <h3>Misc Special Rules</h3>
                <div class="special-rules-list">
                    <div class="special-rule-header">
                        <span>Name</span>
                        <span>Description</span>
                        <span></span>
                    </div>
                    {{#each system.specialRules as |rule idx|}}
                    <div class="special-rule-row">
                        <input type="text" name="system.specialRules.{{idx}}.name" value="{{rule.name}}" placeholder="Rule Name"/>
                        <input type="text" name="system.specialRules.{{idx}}.description" value="{{rule.description}}" placeholder="Description"/>
                        <a class="special-rule-delete" data-index="{{idx}}"><i class="fas fa-trash"></i></a>
                    </div>
                    {{/each}}
                    <button type="button" class="add-special-rule">Add Special Rule</button>
                </div>
            </div>
        </div>

        {{!-- Skills Tab --}}
        <div class="tab skills" data-group="primary" data-tab="skills">
            <h3>Skills</h3>
            <div class="skills-list">
                <div class="skill-header">
                    <span>Name</span>
                    <span>Characteristic</span>
                    <span>Trained</span>
                    <span>Advances</span>
                    <span>Modifier</span>
                    <span>Roll</span>
                </div>
                
                {{#each system.skills as |skill idx|}}
                <div class="skill-row">
                    <input type="text" name="system.skills.{{idx}}.name" value="{{skill.name}}" placeholder="Skill Name" class="rollable-skill" data-skill-index="{{idx}}" title="Click to roll"/>
                    <input type="text" name="system.skills.{{idx}}.characteristic" value="{{skill.characteristic}}" placeholder="Char"/>
                    <input type="checkbox" name="system.skills.{{idx}}.trained" {{checked skill.trained}} />
                    <input type="number" name="system.skills.{{idx}}.advances" value="{{skill.advances}}" />
                    <input type="number" name="system.skills.{{idx}}.modifier" value="{{skill.modifier}}" />
                    <span class="skill-total rollable-skill" data-skill-index="{{idx}}" title="Click to roll">Roll</span>
                    <a class="skill-delete" data-index="{{idx}}"><i class="fas fa-trash"></i></a>
                </div>
                {{/each}}
                
                <button type="button" class="add-skill">Add Skill</button>
            </div>
        </div>

        {{!-- Career Tab --}}
        <div class="tab career" data-group="primary" data-tab="career">
            <p class="hint">Drag career items here from the Items directory to add them to this character.</p>
            
            {{#each careers as |career|}}
            <div class="career-item-simple {{#if career.system.isCurrent}}current-career{{/if}}">
                <div class="career-item-row">
                    <div class="career-name-section">
                        <h3>{{career.name}}</h3>
                        {{#if career.system.isCurrent}}<span class="current-badge">Current</span>{{/if}}
                        {{#if career.system.careerEntered}}<span class="entered-badge">Entered</span>{{/if}}
                    </div>
                    
                    <div class="career-controls-section">
                        <div class="career-checkboxes">
                            <label title="Mark as current career">
                                <input type="checkbox" class="career-current-toggle" data-item-id="{{career.id}}" {{checked career.system.isCurrent}} />
                                Current
                            </label>
                            <label title="Mark career as entered">
                                <input type="checkbox" class="career-entered-toggle" data-item-id="{{career.id}}" {{checked career.system.careerEntered}} />
                                Entered
                            </label>
                        </div>
                        
                        <div class="career-item-controls">
                            <a class="item-control item-edit" data-item-id="{{career.id}}" title="Edit Career"><i class="fas fa-edit"></i></a>
                            <a class="item-control item-delete" data-item-id="{{career.id}}" title="Delete Career"><i class="fas fa-trash"></i></a>
                        </div>
                    </div>
                </div>
            </div>
            {{/each}}
            
            {{#unless careers}}
            <div class="empty-careers">
                <p><i class="fas fa-briefcase fa-3x"></i></p>
                <p><strong>No careers yet</strong></p>
                <p>Create career items in the Items directory and drag them here.</p>
            </div>
            {{/unless}}
        </div>

        {{!-- Combat Tab --}}
        <div class="tab combat" data-group="primary" data-tab="combat">
            <h3>Armour Points</h3>
            <div class="armour-grid">
                <div class="armour-location">
                    <label>Head</label>
                    <input type="number" name="system.armour.head" value="{{system.armour.head}}" />
                </div>
                <div class="armour-location">
                    <label>Body</label>
                    <input type="number" name="system.armour.body" value="{{system.armour.body}}" />
                </div>
                <div class="armour-location">
                    <label>Left Arm</label>
                    <input type="number" name="system.armour.leftArm" value="{{system.armour.leftArm}}" />
                </div>
                <div class="armour-location">
                    <label>Right Arm</label>
                    <input type="number" name="system.armour.rightArm" value="{{system.armour.rightArm}}" />
                </div>
                <div class="armour-location">
                    <label>Left Leg</label>
                    <input type="number" name="system.armour.leftLeg" value="{{system.armour.leftLeg}}" />
                </div>
                <div class="armour-location">
                    <label>Right Leg</label>
                    <input type="number" name="system.armour.rightLeg" value="{{system.armour.rightLeg}}" />
                </div>
            </div>

            <h3>Weapons</h3>
            <p><em>Weapons will be added when item system is implemented</em></p>
            
            <h3>Armour</h3>
            <p><em>Armour items will be added when item system is implemented</em></p>
        </div>

        {{!-- Spells Tab --}}
        <div class="tab spells" data-group="primary" data-tab="spells">
            <h3>Spells</h3>
            <p><em>Spells will be added when item system is implemented</em></p>
        </div>

        {{!-- Inventory Tab --}}
        <div class="tab inventory" data-group="primary" data-tab="inventory">
            <h3>Coin Carried</h3>
            <div class="money-section-inventory">
                <div class="money-field">
                    <label>Gold Crowns (GC)</label>
                    <input type="number" name="system.money.gold" value="{{system.money.gold}}" />
                </div>
                <div class="money-field">
                    <label>Silver Shillings (SS)</label>
                    <input type="number" name="system.money.silver" value="{{system.money.silver}}" />
                </div>
                <div class="money-field">
                    <label>Brass Pennies (BP)</label>
                    <input type="number" name="system.money.brass" value="{{system.money.brass}}" />
                </div>
            </div>
            
            <h3>Inventory</h3>
            <p><em>General items will be added when item system is implemented</em></p>
        </div>

        {{!-- Biography Tab --}}
        <div class="tab biography" data-group="primary" data-tab="biography">
            
            {{!-- Astrology Section --}}
            <h3>Astrology</h3>
            <div class="astrology-section">
                <div class="astrology-field">
                    <label>Star Sign</label>
                    <input type="text" name="system.personalDetails.starSign" value="{{system.personalDetails.starSign}}" placeholder=""/>
                </div>
                <div class="astrology-field">
                    <label>Doom</label>
                    <input type="text" name="system.personalDetails.doom" value="{{system.personalDetails.doom}}" placeholder=""/>
                </div>
            </div>

            {{!-- Appearance Section --}}
            <h3>Appearance</h3>
            <div class="appearance-section">
                <div class="appearance-row">
                    <div class="appearance-field">
                        <label>Gender</label>
                        <input type="text" name="system.personalDetails.gender" value="{{system.personalDetails.gender}}" />
                    </div>
                    <div class="appearance-field">
                        <label>Build</label>
                        <input type="text" name="system.personalDetails.build" value="{{system.personalDetails.build}}" placeholder=""/>
                    </div>
                </div>
                <div class="appearance-row">
                    <div class="appearance-field">
                        <label>Age</label>
                        <input type="number" name="system.personalDetails.age" value="{{system.personalDetails.age}}" />
                    </div>
                    <div class="appearance-field">
                        <label>Height</label>
                        <input type="text" name="system.personalDetails.height" value="{{system.personalDetails.height}}" placeholder=""/>
                    </div>
                </div>
                <div class="appearance-row">
                    <div class="appearance-field">
                        <label>Weight</label>
                        <input type="text" name="system.personalDetails.weight" value="{{system.personalDetails.weight}}" placeholder=""/>
                    </div>
                    <div class="appearance-field">
                        <label>Eyes</label>
                        <input type="text" name="system.personalDetails.eyes" value="{{system.personalDetails.eyes}}" placeholder=""/>
                    </div>
                </div>
                <div class="appearance-row">
                    <div class="appearance-field">
                        <label>Skin</label>
                        <input type="text" name="system.personalDetails.skin" value="{{system.personalDetails.skin}}" placeholder=""/>
                    </div>
                    <div class="appearance-field">
                        <label>Hair</label>
                        <input type="text" name="system.personalDetails.hair" value="{{system.personalDetails.hair}}" placeholder=""/>
                    </div>
                </div>
            </div>

            {{!-- Description Section --}}
            <h3>Description</h3>
            {{editor system.biography target="system.biography" button=true owner=owner editable=editable}}

            {{!-- History Section --}}
            <h3>History</h3>
            {{editor system.history target="system.history" button=true owner=owner editable=editable}}
            
            {{!-- Miscellaneous Notes Section --}}
            <h3>Miscellaneous Notes</h3>
            {{editor system.notes target="system.notes" button=true owner=owner editable=editable}}
        </div>

    </section>
</form>